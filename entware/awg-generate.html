<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AWG (1/1.5/2) ASC Config Generator</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;600;700&family=Unbounded:wght@300;700&display=swap');
  :root {
    --bg:#0a0e14; --surface:#111720; --surface2:#161f2c; --border:#1e2d3d;
    --accent:#00d4aa; --accent2:#0099ff; --warn:#ffa502; --danger:#ff4757;
    --text:#cdd6f4; --muted:#4a6070;
  }
  *{box-sizing:border-box;margin:0;padding:0;}
  body{font-family:'JetBrains Mono',monospace;background:var(--bg);color:var(--text);min-height:100vh;padding:24px;
    background-image:radial-gradient(ellipse 60% 40% at 80% 10%,rgba(0,212,170,.05) 0%,transparent 60%),
    radial-gradient(ellipse 40% 60% at 10% 80%,rgba(0,153,255,.05) 0%,transparent 60%);}
  h1{font-family:'Unbounded',sans-serif;font-size:18px;font-weight:700;color:var(--accent);margin-bottom:4px;}
  .subtitle{font-size:11px;color:var(--muted);margin-bottom:24px;letter-spacing:1px;text-transform:uppercase;}

  /* DROP ZONE */
  .drop-zone{border:2px dashed var(--border);border-radius:10px;padding:22px;text-align:center;
    cursor:pointer;transition:all .2s;margin-bottom:18px;position:relative;background:var(--surface);}
  .drop-zone:hover,.drop-zone.dragover{border-color:var(--accent);background:rgba(0,212,170,.04);}
  .drop-zone input[type=file]{position:absolute;inset:0;opacity:0;cursor:pointer;width:100%;height:100%;}
  .drop-icon{font-size:26px;margin-bottom:6px;}
  .drop-label{font-size:12px;color:var(--muted);}
  .drop-label strong{color:var(--accent);}
  .drop-loaded{font-size:11px;color:var(--accent);margin-top:7px;display:none;}

  /* META */
  .meta-box{background:var(--surface2);border:1px solid var(--border);border-radius:8px;
    padding:13px 15px;margin-bottom:18px;display:none;}
  .meta-box.visible{display:block;}
  .meta-title{font-size:10px;color:var(--accent2);text-transform:uppercase;letter-spacing:1.5px;margin-bottom:9px;}
  .meta-list{display:flex;flex-direction:column;}
  .meta-row{display:flex;gap:8px;padding:3px 0;border-bottom:1px solid rgba(30,45,61,.6);font-size:11px;line-height:1.6;min-width:0;}
  .meta-row:last-child{border-bottom:none;}
  .meta-key{color:var(--muted);flex-shrink:0;width:82px;}
  .meta-val{color:var(--text);flex:1;min-width:0;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;}
  .meta-val.long{cursor:pointer;}
  .meta-val.long:hover,.meta-val.expanded{white-space:normal;word-break:break-all;color:var(--accent);}

  /* TOOLBAR */
  .toolbar{display:flex;gap:7px;flex-wrap:wrap;margin-bottom:13px;align-items:center;}
  .toolbar-label{font-size:10px;color:var(--muted);text-transform:uppercase;letter-spacing:1px;}
  .btn{background:var(--surface);border:1px solid var(--border);border-radius:5px;color:var(--muted);
    font-family:'JetBrains Mono',monospace;font-size:10px;padding:5px 10px;cursor:pointer;
    text-transform:uppercase;letter-spacing:1px;transition:all .15s;white-space:nowrap;}
  .btn:hover{border-color:var(--accent);color:var(--accent);}
  .btn.primary{background:rgba(0,212,170,.1);border-color:rgba(0,212,170,.3);color:var(--accent);}
  .btn.primary:hover{background:rgba(0,212,170,.2);}
  .btn.blue{background:rgba(0,153,255,.08);border-color:rgba(0,153,255,.25);color:var(--accent2);}
  .btn.blue:hover{background:rgba(0,153,255,.15);}
  .btn.copied{color:var(--warn);border-color:var(--warn);background:rgba(255,165,2,.1);}

  /* VERSION TOGGLE */
  .ver-toggle{display:flex;gap:0;margin-bottom:16px;border:1px solid var(--border);border-radius:6px;overflow:hidden;width:fit-content;}
  .ver-btn{font-family:'JetBrains Mono',monospace;font-size:10px;text-transform:uppercase;letter-spacing:1px;
    padding:7px 14px;cursor:pointer;color:var(--muted);background:var(--surface);border:none;transition:all .15s;}
  .ver-btn.active{background:rgba(0,212,170,.12);color:var(--accent);}
  .ver-btn.active.warn{background:rgba(255,165,2,.12);color:var(--warn);}

  /* FIELDS */
  .grid{display:grid;grid-template-columns:1fr 1fr;gap:11px;margin-bottom:11px;}
  .field{display:flex;flex-direction:column;gap:4px;}
  label{font-size:10px;color:var(--muted);text-transform:uppercase;letter-spacing:1.5px;display:flex;align-items:center;gap:5px;}
  .tip{color:var(--accent);font-size:9px;background:rgba(0,212,170,.1);padding:2px 6px;border-radius:3px;}
  .tip.warn{color:var(--warn);background:rgba(255,165,2,.1);}
  input[type=number],input[type=text]{background:var(--surface);border:1px solid var(--border);border-radius:6px;
    color:var(--text);font-family:'JetBrains Mono',monospace;font-size:13px;padding:8px 11px;
    transition:border-color .2s,box-shadow .2s;-moz-appearance:textfield;width:100%;}
  input::-webkit-inner-spin-button,input::-webkit-outer-spin-button{-webkit-appearance:none;}
  input:focus{outline:none;border-color:var(--accent);box-shadow:0 0 0 2px rgba(0,212,170,.12);}
  input.err{border-color:var(--danger);}
  textarea{background:var(--surface);border:1px solid var(--border);border-radius:6px;color:var(--text);
    font-family:'JetBrains Mono',monospace;font-size:11px;padding:8px 11px;width:100%;resize:vertical;
    min-height:70px;transition:border-color .2s;}
  textarea:focus{outline:none;border-color:var(--accent);box-shadow:0 0 0 2px rgba(0,212,170,.12);}
  .desc{font-size:10px;color:var(--muted);line-height:1.6;margin-top:1px;}
  .desc code{background:rgba(0,212,170,.1);color:var(--accent);padding:1px 4px;border-radius:3px;font-size:9px;}
  .desc em{color:var(--warn);}

  .section-title{font-size:10px;color:var(--accent2);text-transform:uppercase;letter-spacing:2px;
    margin:18px 0 9px;display:flex;align-items:center;gap:8px;}
  .section-title::after{content:'';flex:1;height:1px;background:linear-gradient(to right,var(--border),transparent);}

  .info-box{background:rgba(0,153,255,.05);border:1px solid rgba(0,153,255,.18);border-radius:8px;
    padding:11px 13px;margin-bottom:13px;font-size:11px;color:var(--muted);line-height:1.8;}
  .info-box code{background:rgba(0,212,170,.1);color:var(--accent);padding:1px 5px;border-radius:3px;font-size:10px;}
  .info-box.warn-box{background:rgba(255,165,2,.05);border-color:rgba(255,165,2,.2);}
  .hl{color:var(--accent);font-weight:600;}
  .hl-warn{color:var(--warn);font-weight:600;}

  .badge{display:inline-block;font-size:8px;padding:1px 5px;border-radius:3px;vertical-align:middle;margin-left:3px;}
  .badge.opt{background:rgba(74,96,112,.3);color:var(--muted);}
  .badge.v2{background:rgba(255,165,2,.15);color:var(--warn);}
  .badge.v1{background:rgba(0,153,255,.15);color:var(--accent2);}

  .range-pair{display:flex;gap:5px;align-items:center;}
  .range-pair input{flex:1;min-width:0;}
  .range-sep{color:var(--muted);font-size:14px;flex-shrink:0;}

  /* error label */
  .err-label{font-size:10px;color:var(--danger);margin-top:2px;display:none;}
  .err-label.visible{display:block;}

  /* OUTPUT */
  .output{background:var(--surface);border:1px solid var(--border);border-radius:8px;padding:15px;margin-top:15px;}
  .tabs{display:flex;border-bottom:1px solid var(--border);}
  .tab{font-family:'JetBrains Mono',monospace;font-size:10px;text-transform:uppercase;letter-spacing:1px;
    padding:7px 13px;cursor:pointer;color:var(--muted);border:1px solid transparent;border-bottom:none;
    border-radius:5px 5px 0 0;background:transparent;transition:all .15s;margin-bottom:-1px;}
  .tab.active{color:var(--accent);border-color:var(--border);background:var(--surface);}
  .tab-content{display:none;}
  .tab-content.active{display:block;}
  .output-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:11px;padding-top:13px;gap:7px;flex-wrap:wrap;}
  .output-label{font-size:10px;color:var(--muted);text-transform:uppercase;letter-spacing:1.5px;}
  .output-actions{display:flex;gap:5px;}
  pre{font-family:'JetBrains Mono',monospace;font-size:11px;line-height:1.8;color:var(--text);white-space:pre-wrap;word-break:break-all;}
  #cli-output{color:var(--accent);}

  /* hidden by version */
  .v2-only{display:none;}
  .v15-only{display:none;}
  body.ver-20 .v2-only{display:block;}
  body.ver-15 .v15-only{display:block;}
</style>
</head>
<body>

<h1><button style="font-size:12px;" onclick="history.back();return false;"> üîô AWG ¬∑ ASC Config Keenetic</button></h1>
<p class="subtitle">AmneziaWG ¬∑ ASC Settings ¬∑ Keenetic NDM</p>

<!-- DROP ZONE -->
<div class="drop-zone" id="dropZone">
  <input type="file" id="fileInput" accept=".conf,.txt" onchange="handleFile(this.files[0])">
  <div class="drop-icon">üìÑ</div>
  <div class="drop-label">–ü–µ—Ä–µ—Ç–∞—â–∏ <strong>.conf —Ñ–∞–π–ª</strong> –∏–ª–∏ –Ω–∞–∂–º–∏ –¥–ª—è –≤—ã–±–æ—Ä–∞</div>
  <div class="drop-loaded" id="dropLoaded"></div>
</div>

<!-- META -->
<div class="meta-box" id="metaBox">
  <div class="meta-title">üìã –î–∞–Ω–Ω—ã–µ –∫–æ–Ω—Ñ–∏–≥–∞ ‚Äî —Ç–æ–ª—å–∫–æ –¥–ª—è —Å–ø—Ä–∞–≤–∫–∏</div>
  <div class="meta-list" id="metaGrid"></div>
</div>

<!-- VERSION TOGGLE -->
<div class="ver-toggle">
  <button class="ver-btn active" id="vbtn-10" onclick="setVer('10')">AWG 1.0 Legacy</button>
  <button class="ver-btn" id="vbtn-15" onclick="setVer('15')">AWG 1.5</button>
  <button class="ver-btn warn" id="vbtn-20" onclick="setVer('20')">AWG 2.0 ‚ö°</button>
</div>

<div class="info-box" id="verInfo"></div>

<!-- TOOLBAR -->
<div class="toolbar">
  <span class="toolbar-label">–ü—Ä–µ—Å–µ—Ç—ã:</span>
  <button class="btn" onclick="applyPreset('amnezia')">AmneziaWG Default</button>
  <button class="btn" onclick="applyPreset('random')">üé≤ –°–ª—É—á–∞–π–Ω—ã–µ</button>
  <button class="btn" onclick="applyPreset('clear')">–°–±—Ä–æ—Å–∏—Ç—å</button>
</div>

<!-- JUNK -->
<div class="section-title">Junk-–ø–∞–∫–µ—Ç—ã ‚Äî –∏–º–∏—Ç–∞—Ü–∏—è —Å–ª—É—á–∞–π–Ω–æ–≥–æ —Ç—Ä–∞—Ñ–∏–∫–∞</div>
<div class="grid">
  <div class="field">
    <label>Jc ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ junk <span class="tip">1‚Äì128</span></label>
    <input type="number" id="jc" min="1" max="128" placeholder="4" oninput="update()">
    <span class="desc">–ö–æ–ª-–≤–æ ¬´–º—É—Å–æ—Ä–Ω—ã—Ö¬ª UDP-–ø–∞–∫–µ—Ç–æ–≤ –¥–æ handshake. –ë–æ–ª—å—à–µ = –ª—É—á—à–µ –º–∞—Å–∫–∏—Ä–æ–≤–∫–∞, –Ω–æ –º–µ–¥–ª–µ–Ω–Ω–µ–µ —Å—Ç–∞—Ä—Ç. –û–ø—Ç–∏–º—É–º: 3‚Äì8.</span>
  </div>
  <div class="field">
    <label>Jmin <span class="tip">–±–∞–π—Ç</span></label>
    <input type="number" id="jmin" min="0" max="1280" placeholder="40" oninput="update()">
    <span class="desc">–ú–∏–Ω. —Ä–∞–∑–º–µ—Ä junk-–ø–∞–∫–µ—Ç–∞. –†–µ–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä ‚Äî —Å–ª—É—á–∞–π–Ω—ã–π –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ Jmin‚ÄìJmax.</span>
  </div>
  <div class="field">
    <label>Jmax <span class="tip">–±–∞–π—Ç, ‚â• Jmin</span></label>
    <input type="number" id="jmax" min="0" max="1280" placeholder="70" oninput="update()">
    <span class="desc">–ú–∞–∫—Å. —Ä–∞–∑–º–µ—Ä junk-–ø–∞–∫–µ—Ç–∞. –®–∏—Ä–æ–∫–∏–π –¥–∏–∞–ø–∞–∑–æ–Ω —Ç—Ä—É–¥–Ω–µ–µ –¥–µ—Ç–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å.</span>
  </div>
</div>

<!-- PADDING -->
<div class="section-title">Padding ‚Äî –º–∞—Å–∫–∏—Ä–æ–≤–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ –ø–∞–∫–µ—Ç–æ–≤ handshake</div>
<div class="grid">
  <div class="field">
    <label>S1 ‚Äî padding –∏–Ω–∏—Ü–∏–∞—Ü–∏–∏ <span class="tip">–±–∞–π—Ç</span></label>
    <input type="number" id="s1" min="0" max="1280" placeholder="50" oninput="update()">
    <span class="desc">–£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —Ä–∞–∑–º–µ—Ä –ø–∞–∫–µ—Ç–∞ Initiation Handshake. WG –≤—Å–µ–≥–¥–∞ –∏–º–µ–µ—Ç —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ä–∞–∑–º–µ—Ä ‚Äî padding –µ–≥–æ –ª–æ–º–∞–µ—Ç.</span>
  </div>
  <div class="field">
    <label>S2 ‚Äî padding –æ—Ç–≤–µ—Ç–∞ <span class="tip">–±–∞–π—Ç</span></label>
    <input type="number" id="s2" min="0" max="1280" placeholder="50" oninput="update()">
    <span class="desc">Padding –¥–ª—è Response Handshake (—Å—Ç–æ—Ä–æ–Ω–∞ —Å–µ—Ä–≤–µ—Ä–∞).</span>
  </div>
  <div class="field v2-only">
    <label>S3 <span class="badge v2">2.0</span> ‚Äî padding cookie</label>
    <input type="number" id="s3" min="0" max="1280" placeholder="" oninput="update()">
    <span class="desc">Padding –¥–ª—è Cookie Reply –ø–∞–∫–µ—Ç–æ–≤. –î–æ–±–∞–≤–ª–µ–Ω –≤ AWG 2.0.</span>
  </div>
  <div class="field v2-only">
    <label>S4 <span class="badge v2">2.0</span> ‚Äî padding transport</label>
    <input type="number" id="s4" min="0" max="1280" placeholder="" oninput="update()">
    <span class="desc">Padding –¥–ª—è Transport Data –ø–∞–∫–µ—Ç–æ–≤. –î–æ–±–∞–≤–ª–µ–Ω –≤ AWG 2.0.</span>
  </div>
</div>

<!-- MAGIC HEADERS -->
<div class="section-title">Magic Headers ‚Äî –∑–∞–º–µ–Ω–∞ —Å–∏–≥–Ω–∞—Ç—É—Ä–Ω—ã—Ö –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤</div>
<div class="info-box" id="hInfo">
  –í –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–º WG –ø–µ—Ä–≤—ã–µ 4 –±–∞–π—Ç–∞ –∫–∞–∂–¥–æ–≥–æ –ø–∞–∫–µ—Ç–∞ ‚Äî —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–∏–ø: <code>0x01</code> init, <code>0x02</code> response, <code>0x03</code> under load, <code>0x04</code> data. DPI –±–ª–æ–∫–∏—Ä—É–µ—Ç –∏–º–µ–Ω–Ω–æ –ø–æ –Ω–∏–º.<br>
  AWG –∑–∞–º–µ–Ω—è–µ—Ç –∏—Ö —Ç–≤–æ–∏–º–∏ —É–Ω–∏–∫–∞–ª—å–Ω—ã–º–∏ —á–∏—Å–ª–∞–º–∏. <span class="hl">–í—Å–µ H –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Ä–∞–∑–Ω—ã–º–∏ –∏ –Ω–µ –ø–µ—Ä–µ—Å–µ–∫–∞—Ç—å—Å—è!</span>
</div>

<div class="grid" id="hGrid">
  <div class="field">
    <label>H1 ‚Äî init message</label>
    <div class="range-pair">
      <input type="number" id="h1" min="1" max="4294967295" placeholder="1098133141" oninput="update()">
      <span class="range-sep h-range-sep" style="display:none">‚Äì</span>
      <input type="number" id="h1b" min="1" max="4294967295" placeholder="1192664475" oninput="update()" class="h-range-input" style="display:none">
    </div>
    <span class="err-label" id="h1-err"></span>
    <span class="desc">–ó–∞–º–µ–Ω—è–µ—Ç <code>0x01000000</code>. –ü–µ—Ä–≤—ã–π –ø–∞–∫–µ—Ç –∫–ª–∏–µ–Ω—Ç–∞.</span>
  </div>
  <div class="field">
    <label>H2 ‚Äî response message</label>
    <div class="range-pair">
      <input type="number" id="h2" min="1" max="4294967295" placeholder="2042328547" oninput="update()">
      <span class="range-sep h-range-sep" style="display:none">‚Äì</span>
      <input type="number" id="h2b" min="1" max="4294967295" placeholder="2099787149" oninput="update()" class="h-range-input" style="display:none">
    </div>
    <span class="err-label" id="h2-err"></span>
    <span class="desc">–ó–∞–º–µ–Ω—è–µ—Ç <code>0x02000000</code>. –û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞ –Ω–∞ –∏–Ω–∏—Ü–∏–∞—Ü–∏—é.</span>
  </div>
  <div class="field">
    <label>H3 ‚Äî under load</label>
    <div class="range-pair">
      <input type="number" id="h3" min="1" max="4294967295" placeholder="2140257290" oninput="update()">
      <span class="range-sep h-range-sep" style="display:none">‚Äì</span>
      <input type="number" id="h3b" min="1" max="4294967295" placeholder="2141776552" oninput="update()" class="h-range-input" style="display:none">
    </div>
    <span class="err-label" id="h3-err"></span>
    <span class="desc">–ó–∞–º–µ–Ω—è–µ—Ç <code>0x03000000</code>. Cookie Reply –ø—Ä–∏ –Ω–∞–≥—Ä—É–∑–∫–µ.</span>
  </div>
  <div class="field">
    <label>H4 ‚Äî transport data</label>
    <div class="range-pair">
      <input type="number" id="h4" min="1" max="4294967295" placeholder="2143751475" oninput="update()">
      <span class="range-sep h-range-sep" style="display:none">‚Äì</span>
      <input type="number" id="h4b" min="1" max="4294967295" placeholder="2146111773" oninput="update()" class="h-range-input" style="display:none">
    </div>
    <span class="err-label" id="h4-err"></span>
    <span class="desc">–ó–∞–º–µ–Ω—è–µ—Ç <code>0x04000000</code>. –í—Å–µ –æ–±—ã—á–Ω—ã–µ –ø–∞–∫–µ—Ç—ã –¥–∞–Ω–Ω—ã—Ö.</span>
  </div>
</div>

<!-- I PARAMS -->
<div class="section-title v15-only v2-only" style="display:none" id="iSectionTitle">
  I-–ø–∞—Ä–∞–º–µ—Ç—Ä—ã ‚Äî –º–∞—Å–∫–∏—Ä–æ–≤–∫–∞ –ø–æ–¥ –ø—Ä–æ—Ç–æ–∫–æ–ª—ã <span class="badge v2">1.5+</span>
</div>

<div class="info-box warn-box v15-only v2-only" style="display:none" id="iInfoBox">
  <span class="hl-warn">I1‚ÄìI5</span> ‚Äî —ç—Ç–æ –Ω–µ —á–∏—Å–ª–∞, –∞ –±–∏–Ω–∞—Ä–Ω—ã–µ –ø–∞–∫–µ—Ç—ã-—Å–∏–≥–Ω–∞—Ç—É—Ä—ã —Ä–µ–∞–ª—å–Ω—ã—Ö –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–≤ (QUIC, DNS –∏ —Ç.–¥.).<br>
  AWG –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∏—Ö –∫–∞–∫ junk, –∏ DPI –≤–∏–¥–∏—Ç –∑–Ω–∞–∫–æ–º—ã–π –ø—Ä–æ—Ç–æ–∫–æ–ª.<br><br>
  –§–æ—Ä–º–∞—Ç: <code>&lt;b 0xHEX...&gt;</code> ‚Äî hex-–¥–∞–º–ø —Ä–µ–∞–ª—å–Ω–æ–≥–æ UDP-–ø–∞–∫–µ—Ç–∞ –∏–∑ Wireshark.<br>
  –ü—Ä–∏–º–µ—Ä –ø–æ–ª—É—á–µ–Ω–∏—è: –∑–∞—Ö–≤–∞—Ç–∏—Ç—å —Ç—Ä–∞—Ñ–∏–∫ Wireshark ‚Üí –≤—ã–±—Ä–∞—Ç—å UDP-–ø–∞–∫–µ—Ç ‚Üí –ø—Ä–∞–≤–æ–π –∫–Ω–æ–ø–∫–æ–π ‚Üí <em>Copy ‚Üí as Hex Stream</em> ‚Üí –¥–æ–±–∞–≤–∏—Ç—å <code>&lt;b 0x...&gt;</code>.<br><br>
  <span class="hl">–û—Å—Ç–∞–≤—å –ø—É—Å—Ç—ã–º</span> —á—Ç–æ–±—ã –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–∞—Å–∫–∏—Ä–æ–≤–∫—É –ø–æ–¥ –ø—Ä–æ—Ç–æ–∫–æ–ª. –í AWG 2.0 –∑–Ω–∞—á–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–∞ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –∫–æ –≤—Å–µ–º –∫–ª–∏–µ–Ω—Ç–∞–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.
</div>

<div class="grid v15-only v2-only" style="display:none" id="iGrid">
  <div class="field" style="grid-column:1/-1">
    <label>I1 ‚Äî –ø–µ—Ä–≤—ã–π junk-–ø–∞–∫–µ—Ç <span class="tip warn">hex payload</span></label>
    <textarea id="i1" placeholder="<b 0xc70000000108ce1bf31eec7d93...> ‚Äî hex –∏–∑ Wireshark –∏–ª–∏ –æ—Å—Ç–∞–≤—å –ø—É—Å—Ç—ã–º" oninput="update()"></textarea>
    <span class="desc">–°–∞–º—ã–π –≤–∞–∂–Ω—ã–π. –û–±—ã—á–Ω–æ —Å–∏–≥–Ω–∞—Ç—É—Ä–∞ QUIC Initial –ø–∞–∫–µ—Ç–∞. –ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –¥–ª—è –º–∞—Å–∫–∏—Ä–æ–≤–∫–∏ –ø–µ—Ä–≤–æ–≥–æ junk –¥–æ handshake.</span>
  </div>
  <div class="field">
    <label>I2 <span class="badge opt">opt</span></label>
    <textarea id="i2" placeholder="<b 0x...>" rows="2" oninput="update()"></textarea>
  </div>
  <div class="field">
    <label>I3 <span class="badge opt">opt</span></label>
    <textarea id="i3" placeholder="<b 0x...>" rows="2" oninput="update()"></textarea>
  </div>
  <div class="field">
    <label>I4 <span class="badge opt">opt</span></label>
    <textarea id="i4" placeholder="<b 0x...>" rows="2" oninput="update()"></textarea>
  </div>
  <div class="field">
    <label>I5 <span class="badge opt">opt</span></label>
    <textarea id="i5" placeholder="<b 0x...>" rows="2" oninput="update()"></textarea>
  </div>
</div>

<!-- INTERFACE NAME + DNS -->
<div class="section-title">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ</div>
<div class="grid">
  <div class="field">
    <label>–ò–º—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ Keenetic</label>
    <input type="text" id="ifname" value="Wireguard0" oninput="update()">
  </div>
  <div class="field">
    <label>DNS <span class="badge opt">opt</span></label>
    <input type="text" id="dns" placeholder="1.1.1.1, 9.9.9.9" oninput="update()">
    <span class="desc">–û–¥–∏–Ω –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ DNS —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é. –ü–æ–¥—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –≤ –ø–æ–ª–Ω—ã–π .conf –∏ Entware –∫–æ–º–∞–Ω–¥—ã.</span>
  </div>
</div>

<div id="hex-warn" style="display:none;background:rgba(255,165,2,.08);border:1px solid rgba(255,165,2,.3);border-radius:8px;padding:11px 14px;margin-top:14px;font-size:11px;color:var(--warn);line-height:1.7;">
  ‚ö†Ô∏è <strong>I-–ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Å &lt;b 0x...&gt; —á–µ—Ä–µ–∑ CLI/SSH –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç</strong> ‚Äî —Å—Ç—Ä–æ–∫–∞ —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω–∞—è –¥–ª—è —Ç–µ—Ä–º–∏–Ω–∞–ª–∞.<br>
  –ò—Å–ø–æ–ª—å–∑—É–π –≤–∫–ª–∞–¥–∫—É <strong>–°–∫–∞—á–∞—Ç—å .conf</strong> ‚Üí —Å–∫–∞—á–∞–π —Ñ–∞–π–ª ‚Üí –∏–º–ø–æ—Ä—Ç–∏—Ä—É–π —á–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å Keenetic –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö WireGuard.
</div>

<!-- OUTPUT -->
<div class="output">
  <div class="tabs">
    <button class="tab active" onclick="switchTab('cli',this)">CLI –∫–æ–º–∞–Ω–¥–∞</button>
    <button class="tab" onclick="switchTab('ssh',this)">Entware SSH</button>
    <button hidden class="tab" onclick="switchTab('conf',this)">[Interface] —Å–µ–∫—Ü–∏—è</button>
    <button class="tab" onclick="switchTab('full',this)">–°–∫–∞—á–∞—Ç—å .conf</button>
  </div>

  <div id="tab-cli" class="tab-content active">
    <div class="output-header">
      <span class="output-label">Keenetic CLI</span>
      <div class="output-actions">
        <button class="btn primary" onclick="copyPre('cli-output',this)">Copy</button>
      </div>
    </div>
    <pre id="cli-output"></pre>
  </div>

  <div id="tab-ssh" class="tab-content">
    <div class="output-header">
      <span class="output-label">Entware SSH ‚Äî ndmc –∫–æ–º–∞–Ω–¥—ã</span>
      <div class="output-actions">
        <button class="btn primary" onclick="copyPre('ssh-output',this)">Copy</button>
      </div>
    </div>
    <pre id="ssh-output"></pre>
  </div>

  <div hidden id="tab-conf" class="tab-content">
    <div class="output-header">
      <span class="output-label">[Interface] —Å–µ–∫—Ü–∏—è</span>
      <div class="output-actions">
        <button class="btn primary" onclick="copyPre('conf-output',this)">Copy</button>
      </div>
    </div>
    <pre id="conf-output"></pre>
  </div>

  <div id="tab-full" class="tab-content">
    <div class="output-header">
      <span class="output-label">–°–∫–∞—á–∞—Ç—å .conf —Ñ–∞–π–ª</span>
      <div class="output-actions">
        <button class="btn blue" onclick="downloadConf()">‚¨á –°–∫–∞—á–∞—Ç—å .conf</button>
        <button class="btn primary" onclick="copyPre('full-output',this)">Copy</button>
      </div>
    </div>
    <pre id="full-output"></pre>
  </div>
</div>

<script>
// ‚îÄ‚îÄ State ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let parsed = null;
let curVer = '10';

const VER_INFO = {
  '10': 'AWG <b>1.0 Legacy</b> ‚Äî –±–∞–∑–æ–≤–∞—è –≤–µ—Ä—Å–∏—è. –ü–∞—Ä–∞–º–µ—Ç—Ä—ã: Jc, Jmin, Jmax, S1, S2, H1‚ÄìH4. I1‚ÄìI5 –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è.',
  '15': 'AWG <b>1.5</b> ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω—ã I1‚ÄìI5 (–±–∏–Ω–∞—Ä–Ω—ã–µ –ø–∞–∫–µ—Ç—ã-—Å–∏–≥–Ω–∞—Ç—É—Ä—ã –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–≤ –¥–ª—è –º–∞—Å–∫–∏—Ä–æ–≤–∫–∏ junk-—Ç—Ä–∞—Ñ–∏–∫–∞). H1‚ÄìH4 ‚Äî –æ–¥–∏–Ω–æ—á–Ω—ã–µ —á–∏—Å–ª–∞.',
  '20': 'AWG <b>2.0</b> ‚Äî —Ç–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è. –î–æ–±–∞–≤–ª–µ–Ω—ã S3/S4. H1‚ÄìH4 —Ç–µ–ø–µ—Ä—å <b>–¥–∏–∞–ø–∞–∑–æ–Ω—ã</b> ‚Äî –∫–∞–∂–¥—ã–π —Ä–∞–∑ –≤—ã–±–∏—Ä–∞–µ—Ç—Å—è —Å–ª—É—á–∞–π–Ω–æ–µ —á–∏—Å–ª–æ, –¥–∏–∞–ø–∞–∑–æ–Ω—ã –Ω–µ –¥–æ–ª–∂–Ω—ã –ø–µ—Ä–µ—Å–µ–∫–∞—Ç—å—Å—è. –¢—Ä–µ–±—É–µ—Ç AmneziaVPN 4.8.12.7+.',
};

// ‚îÄ‚îÄ Version switch ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function setVer(v) {
  curVer = v;
  document.querySelectorAll('.ver-btn').forEach(b => b.classList.remove('active'));
  document.getElementById('vbtn-' + v).classList.add('active');
  document.getElementById('verInfo').innerHTML = VER_INFO[v];

  // body class for CSS show/hide
  document.body.className = 'ver-' + v;

  // H range inputs visibility
  const showRange = v === '20';
  document.querySelectorAll('.h-range-sep').forEach(el => el.style.display = showRange ? 'inline' : 'none');
  document.querySelectorAll('.h-range-input').forEach(el => el.style.display = showRange ? 'block' : 'none');

  // I section & grid
  const showI = v === '15' || v === '20';
  document.getElementById('iSectionTitle').style.display = showI ? 'flex' : 'none';
  document.getElementById('iInfoBox').style.display = showI ? 'block' : 'none';
  document.getElementById('iGrid').style.display = showI ? 'grid' : 'none';

  update();
}

// ‚îÄ‚îÄ Drag & Drop ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const dz = document.getElementById('dropZone');
dz.addEventListener('dragover', e => { e.preventDefault(); dz.classList.add('dragover'); });
dz.addEventListener('dragleave', () => dz.classList.remove('dragover'));
dz.addEventListener('drop', e => { e.preventDefault(); dz.classList.remove('dragover'); const f = e.dataTransfer.files[0]; if(f) handleFile(f); });

function handleFile(file) {
  const r = new FileReader();
  r.onload = e => parseConf(e.target.result, file.name);
  r.readAsText(file);
}

function parseConf(text, filename) {
  parsed = { filename, raw: text, iface: {}, peer: {} };
  let sec = null;
  for (const raw of text.split('\n')) {
    const line = raw.trim();
    if (!line || line.startsWith('#')) continue;
    if (line === '[Interface]') { sec = 'iface'; continue; }
    if (line === '[Peer]') { sec = 'peer'; continue; }
    if (!sec) continue;
    const eq = line.indexOf('=');
    if (eq < 0) continue;
    const k = line.slice(0, eq).trim().toLowerCase();
    const v = line.slice(eq + 1).trim();
    parsed[sec][k] = v;
  }

  const iface = parsed.iface;

  // Simple numeric ASC fields
  ['jc','jmin','jmax','s1','s2','s3','s4'].forEach(f => {
    const el = document.getElementById(f);
    if (el) el.value = (iface[f] && iface[f] !== '') ? iface[f] : '';
  });

  // DNS field
  const dnsEl = document.getElementById('dns');
  if (dnsEl) dnsEl.value = iface.dns || '';

  // I params (textarea)
  ['i1','i2','i3','i4','i5'].forEach(f => {
    const el = document.getElementById(f);
    if (el) el.value = (iface[f] && iface[f] !== '') ? iface[f] : '';
  });

  // H params ‚Äî detect version
  let isV2 = false;
  let hasI = false;
  ['h1','h2','h3','h4'].forEach(h => {
    const val = iface[h] || '';
    if (val.includes('-')) {
      isV2 = true;
      const [a, b] = val.split('-');
      document.getElementById(h).value = a.trim();
      document.getElementById(h + 'b').value = b.trim();
    } else {
      document.getElementById(h).value = val;
      document.getElementById(h + 'b').value = '';
    }
  });

  ['i1','i2','i3','i4','i5'].forEach(f => {
    if (iface[f] && iface[f].trim() !== '') hasI = true;
  });

  // Auto-detect version
  const hasS3S4 = (iface.s3 && iface.s3 !== '') || (iface.s4 && iface.s4 !== '');
  if (isV2 || hasS3S4) setVer('20');
  else if (hasI) setVer('15');
  else setVer('10');

  document.getElementById('dropLoaded').textContent = '‚úÖ ' + filename;
  document.getElementById('dropLoaded').style.display = 'block';
  showMeta();
  update();
}

function showMeta() {
  const iface = parsed.iface, peer = parsed.peer;
  const rows = [
    ['Address', iface.address], ['DNS', iface.dns],
    ['Endpoint', peer.endpoint], ['PublicKey', peer.publickey],
    ['PresharedKey', peer.presharedkey ? '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢' : null],
    ['AllowedIPs', peer.allowedips], ['Keepalive', peer.persistentkeepalive],
  ].filter(([,v]) => v);
  const mb = document.getElementById('metaBox');
  document.getElementById('metaGrid').innerHTML = rows.map(([k,v]) => {
    const isLong = String(v).length > 36;
    const esc = String(v).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
    return `<div class="meta-row"><span class="meta-key">${k}</span><span class="meta-val${isLong?' long':''}" onclick="this.classList.toggle('expanded')">${esc}</span></div>`;
  }).join('');
  mb.classList.add('visible');
}

// ‚îÄ‚îÄ Presets ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function applyPreset(name) {
  const allFields = ['jc','jmin','jmax','s1','s2','s3','s4','h1','h1b','h2','h2b','h3','h3b','h4','h4b','i1','i2','i3','i4','i5'];
  if (name === 'clear') {
    allFields.forEach(f => { const el = document.getElementById(f); if(el) el.value = ''; });
  } else if (name === 'amnezia') {
    const p = {jc:4,jmin:40,jmax:70,s1:50,s2:50,h1:1234567891,h2:1234567892,h3:1234567893,h4:1234567894};
    Object.entries(p).forEach(([k,v]) => { const el = document.getElementById(k); if(el) el.value = v; });
    ['h1b','h2b','h3b','h4b','s3','s4','i1','i2','i3','i4','i5'].forEach(f => { const el = document.getElementById(f); if(el) el.value = ''; });
  } else if (name === 'random') {
    document.getElementById('jc').value = rnd(1, 10);
    const jmin = rnd(20, 70);
    document.getElementById('jmin').value = jmin;
    document.getElementById('jmax').value = rnd(jmin + 10, Math.min(1280, jmin + 120));
    document.getElementById('s1').value = rnd(15, 120);
    document.getElementById('s2').value = rnd(15, 120);
    if (curVer === '20') {
      document.getElementById('s3').value = rnd(5, 60);
      document.getElementById('s4').value = rnd(5, 60);
    }
    // Generate non-overlapping H ranges
    const ranges = genNonOverlappingRanges(4);
    ['h1','h2','h3','h4'].forEach((h, i) => {
      document.getElementById(h).value = ranges[i][0];
      if (curVer === '20') document.getElementById(h + 'b').value = ranges[i][1];
    });
  }
  update();
}

function genNonOverlappingRanges(count) {
  // Split 0‚Äì4294967295 into non-overlapping segments
  const total = 4294967295;
  const step = Math.floor(total / count);
  const res = [];
  for (let i = 0; i < count; i++) {
    const base = i * step + rnd(1000, 50000000);
    const width = rnd(10000000, 80000000);
    res.push([base, Math.min(base + width, (i + 1) * step - 1)]);
  }
  return res;
}

function rnd(a, b) { return Math.floor(Math.random() * (b - a + 1)) + a; }

// ‚îÄ‚îÄ Get field values ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function gv(id) { const el = document.getElementById(id); if(!el) return null; const v = el.value.trim(); return v === '' ? null : v; }

function getH(n) {
  // –î–ª—è CLI/SSH ‚Äî –æ–¥–Ω–æ —á–∏—Å–ª–æ (—Å–ª—É—á–∞–π–Ω–æ–µ –∏–∑ –¥–∏–∞–ø–∞–∑–æ–Ω–∞ –µ—Å–ª–∏ AWG 2.0)
  const a = gv('h' + n);
  if (!a) return null;
  if (curVer === '20') {
    const b = gv('h' + n + 'b');
    if (b) return String(rnd(parseInt(a), parseInt(b)));
  }
  return a;
}

function getHRange(n) {
  // –î–ª—è .conf —Ñ–∞–π–ª–∞ ‚Äî –¥–∏–∞–ø–∞–∑–æ–Ω –∫–∞–∫ –µ—Å—Ç—å
  const a = gv('h' + n);
  if (!a) return null;
  if (curVer === '20') {
    const b = gv('h' + n + 'b');
    if (b) return `${a}-${b}`;
  }
  return a;
}


// ‚îÄ‚îÄ Validate H ranges ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function validateH() {
  let ok = true;
  if (curVer !== '20') {
    ['h1','h2','h3','h4'].forEach(h => {
      document.getElementById(h + '-err').classList.remove('visible');
      document.getElementById(h).classList.remove('err');
    });
    return true;
  }

  // Check ranges don't overlap
  const ranges = ['h1','h2','h3','h4'].map(h => {
    const a = parseInt(gv(h) || '0');
    const b = parseInt(gv(h + 'b') || gv(h) || '0');
    return [Math.min(a,b), Math.max(a,b), h];
  });

  ['h1','h2','h3','h4'].forEach(h => {
    document.getElementById(h + '-err').textContent = '';
    document.getElementById(h + '-err').classList.remove('visible');
    document.getElementById(h).classList.remove('err');
    document.getElementById(h + 'b').classList.remove('err');
  });

  for (let i = 0; i < ranges.length; i++) {
    for (let j = i + 1; j < ranges.length; j++) {
      const [a1,a2,ha] = ranges[i], [b1,b2,hb] = ranges[j];
      if (a1 <= b2 && b1 <= a2) {
        const errA = document.getElementById(ha + '-err');
        errA.textContent = `–ü–µ—Ä–µ—Å–µ–∫–∞–µ—Ç—Å—è —Å ${hb.toUpperCase()}!`;
        errA.classList.add('visible');
        document.getElementById(ha).classList.add('err');
        document.getElementById(ha + 'b').classList.add('err');
        ok = false;
      }
    }
  }
  return ok;
}

// ‚îÄ‚îÄ Build outputs ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function buildASC() {
  const f = (k, v) => v !== null ? `${k} = ${v}\n` : '';
  let s = '';
  s += f('Jc', gv('jc'));
  s += f('Jmin', gv('jmin'));
  s += f('Jmax', gv('jmax'));
  s += f('S1', gv('s1'));
  s += f('S2', gv('s2'));
  if (curVer === '20') {
    s += f('S3', gv('s3'));
    s += f('S4', gv('s4'));
  }
  s += f('H1', getHRange(1));
  s += f('H2', getHRange(2));
  s += f('H3', getHRange(3));
  s += f('H4', getHRange(4));
  if (curVer === '15' || curVer === '20') {
    ['i1','i2','i3','i4','i5'].forEach((k,i) => {
      const v = gv(k);
      s += `I${i+1} = ${v !== null ? v : ''}\n`;
    });
  }
  return s;
}

function buildFullConf() {
  const iface = parsed ? parsed.iface : {};
  const peer = parsed ? parsed.peer : {};
  const dns = gv('dns') || iface.dns || null;
  let s = '[Interface]\n';
  if (iface.address) s += `Address = ${iface.address}\n`;
  if (dns) s += `DNS = ${dns}\n`;
  if (iface.privatekey) s += `PrivateKey = ${iface.privatekey}\n`;
  s += buildASC();
  if (parsed && Object.keys(peer).length > 0) {
    s += '\n[Peer]\n';
    if (peer.publickey) s += `PublicKey = ${peer.publickey}\n`;
    if (peer.presharedkey) s += `PresharedKey = ${peer.presharedkey}\n`;
    if (peer.allowedips) s += `AllowedIPs = ${peer.allowedips}\n`;
    if (peer.endpoint) s += `Endpoint = ${peer.endpoint}\n`;
    if (peer.persistentkeepalive) s += `PersistentKeepalive = ${peer.persistentkeepalive}\n`;
  }
  return s;
}

function buildAscArgs() {
  // {jc} {jmin} {jmax} {s1} {s2} {h1} {h2} {h3} {h4} [{s3} {s4} {i1} {i2} {i3} {i4} {i5}]
  // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –≥—Ä—É–ø–ø–∞: –ª–∏–±–æ –≤—Å–µ 7, –ª–∏–±–æ –Ω–∏–∫–∞–∫–∏–µ. –ü—É—Å—Ç—ã–µ = 0.
  // hex I-–ø–∞—Ä–∞–º–µ—Ç—Ä—ã <b 0x...> CLI –Ω–µ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç ‚Äî –∑–∞–º–µ–Ω—è–µ–º –Ω–∞ 0
  const req = [gv('jc'), gv('jmin'), gv('jmax'), gv('s1'), gv('s2'), getH(1), getH(2), getH(3), getH(4)];
  if (req.some(x => !x)) return null;

  const sanitizeI = k => {
    const v = gv(k);
    if (!v) return null;
    if (v.includes('<b ')) return null; // hex-—Å—Ç—Ä–æ–∫–∏ –Ω–µ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ CLI –≤–æ–æ–±—â–µ
    return v;
  };

  if (curVer === '10') return req.join(' ');

  if (curVer === '15') {
    const iVals = ['i1','i2','i3','i4','i5'].map(sanitizeI);
    const hasAny = iVals.some(v => v !== null);
    if (!hasAny) return req.join(' ');
    // –¢–æ–ª—å–∫–æ –¥–æ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ–≥–æ
    let lastI = -1;
    for (let i = iVals.length - 1; i >= 0; i--) {
      if (iVals[i] !== null) { lastI = i; break; }
    }
    return req.join(' ') + ' ' + iVals.slice(0, lastI + 1).map(v => v || '0').join(' ');
  }

  // 2.0 ‚Äî –≤—Å–µ 7
  const optRaw = [gv('s3'), gv('s4'), ...['i1','i2','i3','i4','i5'].map(sanitizeI)];
  const hasAny = optRaw.some(v => v !== null);
  if (!hasAny) return req.join(' ');
  return req.join(' ') + ' ' + optRaw.map(v => v || '0').join(' ');
}

function hasHexIParams() {
  return ['i1','i2','i3','i4','i5'].some(k => {
    const v = gv(k);
    return v && v.includes('<b ');
  });
}

function buildCLI() {
  const ifname = gv('ifname') || 'Wireguard0';
  const args = buildAscArgs();
  if (!args) return '# –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è: Jc, Jmin, Jmax, S1, S2, H1‚ÄìH4';
  return `interface ${ifname} wireguard asc ${args}\nsystem configuration save`;
}

function buildSSH() {
  const ifname = gv('ifname') || 'Wireguard0';
  const args = buildAscArgs();
  if (!args) return '# –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è: Jc, Jmin, Jmax, S1, S2, H1‚ÄìH4';
  return `ndmc -c "interface ${ifname} wireguard asc ${args}"\nndmc -c "system configuration save"`;
}

function update() {
  validateH();
  document.getElementById('cli-output').textContent = buildCLI();
  document.getElementById('ssh-output').textContent = buildSSH();
  document.getElementById('conf-output').textContent = '[Interface]\n' + buildASC();
  document.getElementById('full-output').textContent = buildFullConf();

  // –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –ø—Ä–æ hex I-–ø–∞—Ä–∞–º–µ—Ç—Ä—ã
  const warn = document.getElementById('hex-warn');
  if (warn) warn.style.display = hasHexIParams() ? 'block' : 'none';
}

// ‚îÄ‚îÄ Tabs ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function switchTab(name, btn) {
  document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
  document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
  btn.classList.add('active');
  document.getElementById('tab-' + name).classList.add('active');
}

// ‚îÄ‚îÄ Copy / Download ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function copyPre(id, btn) {
  navigator.clipboard.writeText(document.getElementById(id).textContent).then(() => {
    const o = btn.textContent;
    btn.textContent = '‚úì Copied!';
    btn.classList.add('copied');
    setTimeout(() => { btn.textContent = o; btn.classList.remove('copied'); }, 1500);
  });
}

function downloadConf() {
  const text = document.getElementById('full-output').textContent;
  const fname = parsed ? parsed.filename.replace(/\.conf$/i,'') + '_modified.conf' : 'awg_config.conf';
  const a = document.createElement('a');
  a.href = 'data:text/plain;charset=utf-8,' + encodeURIComponent(text);
  a.download = fname;
  a.click();
}

// ‚îÄ‚îÄ Init ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
setVer('10');
</script>
</body>
</html>
